"""Runtime i18n support for Chinese/English UI switching."""

from __future__ import annotations

from typing import Dict

from PySide6.QtCore import QTranslator


def normalize_language(value: str | None) -> str:
    raw = str(value or "").strip().lower()
    if raw in ("en", "en_us", "en-us", "english"):
        return "en"
    if raw in ("zh", "zh_cn", "zh-cn", "chinese", "简体中文"):
        return "zh"
    return "zh"


class DictTranslator(QTranslator):
    """QTranslator backed by an in-memory dictionary."""

    def __init__(self, mapping: Dict[str, str]):
        super().__init__()
        self._mapping = dict(mapping)

    def translate(self, context, source_text, disambiguation=None, n=-1):  # type: ignore[override]
        if source_text in self._mapping:
            return self._mapping[source_text]
        return ""


EN_TRANSLATIONS: Dict[str, str] = {
    # Main menu
    "设置": "Settings",
    "呼号和密码设置": "Callsign & Password",
    "一般设置": "General Settings",
    "发射设置": "Transmit Settings",
    "服务器设置": "Server Settings",
    "MorseLink连接器设置": "MorseLink Connector Settings",
    "QSO记录": "QSO Records",
    "在线通联": "Online QSO",
    "开始训练": "Start Training",
    "帮助": "Help",
    "常用短语": "Common Phrases",
    "参考表": "Reference Table",
    "使用说明": "User Guide",
    "关于": "About",
    # Shared
    "提示": "Notice",
    "错误": "Error",
    "成功": "Success",
    "确认": "Confirm",
    "取消": "Cancel",
    "保存": "Save",
    "Close": "Close",
    "MorseLink": "MorseLink",
    "English": "English",
    "Ctrl": "Ctrl",
    "放弃更改": "Discard Changes",
    "有未保存的改动，确认放弃吗？": "You have unsaved changes. Discard them?",
    "无": "None",
    # General settings
    "字体大小:": "Font Size:",
    "键控模式:": "Keyer Mode:",
    "手键": "Straight Key",
    "Single Paddle": "Single Paddle",
    "Iambic A": "Iambic A",
    "Iambic B": "Iambic B",
    "Single 双按策略:": "Single Dual-Press Policy:",
    "DAH 优先（固定）": "DAH Priority (Fixed)",
    "接收后禁发尾巴(ms):": "RX-to-TX Lock Tail (ms):",
    "键盘发送:": "Keyboard Sending:",
    "设置按键": "Set Keys",
    "切换": "Toggle",
    "空格": "Space",
    "发送蜂鸣声: ": "Send Buzzer: ",
    "接收蜂鸣声: ": "Receive Buzzer: ",
    "消息显示与翻译: ": "Message Visibility & Translation: ",
    "摩尔斯电码动画: ": "Morse Animation: ",
    "已启用": "Enabled",
    "已禁用": "Disabled",
    "蜂鸣器频率: {0} Hz": "Buzzer Frequency: {0} Hz",
    "恢复出厂设置": "Reset to Factory Defaults",
    "将恢复当前页面默认值，并在保存时重置课程进度和清空通联记录，是否继续？": (
        "This will restore defaults on this page and reset training progress + clear QSO records when saved. Continue?"
    ),
    "已恢复默认值；点击“保存”后将同时重置课程进度并清空通联记录": (
        "Defaults restored. Click Save to also reset training progress and clear QSO records."
    ),
    "请按下 Dah 键（按 Esc 取消）": "Press Dah key (Esc to cancel)",
    "请按下 Dit 键": "Press Dit key",
    "按键设置已取消": "Key setup cancelled",
    "按键设置完成": "Key setup completed",
    "Dah 与 Dit 不能使用同一个键": "Dah and Dit cannot use the same key",
    "重置课程进度/通联记录失败：{0}": "Failed to reset training progress/QSO records: {0}",
    "界面语言:": "UI Language:",
    "简体中文": "Simplified Chinese",
    "语言切换提示": "Language Change",
    "语言切换将在重启应用后生效。": "Language change will take effect after restarting the app.",
    # Callsign dialog
    "呼号与密码设置": "Callsign & Password",
    "呼号:": "Callsign:",
    "请输入您的呼号": "Enter your callsign",
    "密码:": "Password:",
    "留空表示不修改密码": "Leave empty to keep current password",
    "确认密码:": "Confirm Password:",
    "再次输入新密码": "Enter the new password again",
    "提示：当前协议使用明文账号密码认证，后续将支持更加安全的协议。": (
        "Tip: Current protocol uses plain-text credentials. More secure auth will be supported later."
    ),
    "输入错误": "Input Error",
    "呼号不能为空": "Callsign cannot be empty",
    "密码长度需在 6-32 位之间": "Password length must be 6-32",
    "两次输入的密码不一致": "Passwords do not match",
    # Server dialog
    "当前选择:": "Current Selection:",
    "服务器列表 (mqtt://host:port 或 mqtts://host:port):": "Server List (mqtt://host:port or mqtts://host:port):",
    "添加服务器:": "Add Server:",
    "主机，例如 mqtt.example.com 或 192.168.1.10": "Host, e.g. mqtt.example.com or 192.168.1.10",
    "添加": "Add",
    "MQTTS/TLS 设置:": "MQTTS/TLS Settings:",
    "CA 证书路径（可选，PEM/CRT/CER）": "CA certificate path (optional, PEM/CRT/CER)",
    "浏览": "Browse",
    "启用证书校验（关闭则默认跳过）": "Enable certificate validation (disabled means skip by default)",
    "选择 CA 证书": "Select CA Certificate",
    "证书文件 (*.pem *.crt *.cer);;所有文件 (*)": "Certificate Files (*.pem *.crt *.cer);;All Files (*)",
    "CSV 文件 (*.csv)": "CSV Files (*.csv)",
    "修改": "Edit",
    "删除": "Delete",
    "修改服务器": "Edit Server",
    "输入新的 mqtt://host:port 或 mqtts://host:port": "Enter new mqtt://host:port or mqtts://host:port",
    "主机格式无效": "Invalid host format",
    "端口范围必须是 1~65535": "Port range must be 1-65535",
    "该服务器已存在": "This server already exists",
    "请至少保留一个服务器": "Please keep at least one server",
    "当前选择的服务器无效": "Current selected server is invalid",
    "CA 证书文件不存在": "CA certificate file not found",
    # Online page
    "当前人数: 未连接服务器": "Participants: Not connected",
    "当前中心频率: {0} kHz": "Center Frequency: {0} kHz",
    "清理屏幕": "Clear Screen",
    "清屏": "Clear",
    "点击发报": "Hold to Send",
    "收到电码": "Received Morse",
    "收到翻译": "Received Translation",
    "发送翻译": "Sent Translation",
    "发送电码": "Sent Morse",
    "站点状态": "Station Status",
    "状态：未连接": "Status: Disconnected",
    "频率控制": "Frequency Control",
    "通道操作": "Channel Actions",
    "CW 发报": "CW Keying",
    "按住按钮发报 · 与可视化区域同步反馈": "Hold to key · synchronized with visualizer feedback",
    "解码结果": "Decode Result",
    "符号判决": "Symbol Decisions",
    "原始点划": "Raw Morse",
    "连接服务器": "Connect",
    "连接中": "Connecting",
    "断开连接": "Disconnect",
    "状态：连接中": "Status: Connecting",
    "状态：连接超时": "Status: Connection Timeout",
    "状态：连接失败": "Status: Connection Failed",
    "状态：已连接": "Status: Connected",
    "连接超时，请检查网络或服务器配置": "Connection timed out. Please check network or server configuration.",
    "连接初始化失败，请检查服务器设置": "Connection initialization failed. Please check server settings.",
    "在线通联前请先设置呼号（无限制）": "Please set your callsign before online QSO",
    "错误信息：": "Error: ",
    "JWT 认证暂未启用，请先使用呼号和密码登录": "JWT authentication is not enabled yet. Please use callsign/password.",
    "不支持的认证类型": "Unsupported authentication type",
    "服务器主机不能为空": "Server host cannot be empty",
    "在线通联前请先设置呼号和密码": "Please set callsign and password before online QSO",
    "无法启动连接，请检查服务器地址/端口": "Unable to start connection. Check server address/port.",
    "连接失败，请检查服务器地址、账号密码或网络": (
        "Connection failed. Check server address, account/password, or network."
    ),
    "正在发射": "Transmitting",
    "未知台站": "Unknown Station",
    # Training home
    "阶段选择": "Stage Selection",
    "新手教学": "Beginner Tutorial",
    "入门课程": "Intro Course",
    "入门": "Intro",
    "初级": "Beginner",
    "中级": "Intermediate",
    "熟练": "Advanced",
    "当前进度：0 / 0": "Progress: 0 / 0",
    "目标：-": "Objective: -",
    "新增字符：无": "New chars: None",
    "完成 Unit": "Completed Units",
    "连续天数": "Streak Days",
    "总 XP": "Total XP",
    "本 Unit 新增": "New in Unit",
    "课程 Unit": "Course Units",
    "今天目标：完成 3 个 Unit（0/3）": "Today's goal: complete 3 Units (0/3)",
    "继续学习": "Continue Learning",
    "继续巩固": "Continue Practice",
    "点击 Unit 卡片可开始训练。": "Click a Unit card to start training.",
    "下一阶段尚未解锁。": "Next stage is not unlocked yet.",
    "训练进行中": "Training in Progress",
    "准备就绪": "Ready",
    "停止": "Stop",
    "目标：": "Objective:",
    "Unit 完成": "Unit Complete",
    "准确率：0.0%": "Accuracy: 0.0%",
    "节奏评分：0.0": "Rhythm: 0.0",
    "评级：C": "Grade: C",
    "XP +0": "XP +0",
    "连击 +0": "Combo +0",
    "继续下一个": "Next Unit",
    "再练一次": "Retry",
    "该阶段尚未解锁。": "This stage is not unlocked.",
    " · 当前": " · Current",
    " · 未解锁": " · Locked",
    "锁定 | ": "Locked | ",
    "{0}课程": "{0} Course",
    "当前进度：{0}/{1} Unit，正在学习 Unit {2}": "Progress: {0}/{1} Units, now on Unit {2}",
    "今天目标：完成 {0} 个 Unit（{1}/{0}） | 连续学习 {2} 天": (
        "Today's goal: {1}/{0} Units | {2} day streak"
    ),
    "目标：{0}": "Objective: {0}",
    "新增字符：{0}": "New chars: {0}",
    "{0} Unit 列表": "{0} Unit List",
    "{0}天": "{0} days",
    "开始训练 Unit {0}": "Start Unit {0}",
    "复习新手教学": "Review Tutorial",
    "完成新手教学": "Finish Tutorial",
    "下一阶段 {0} 尚未解锁。": "Next stage {0} is not unlocked.",
    "已解锁全部阶段，可继续刷星提升表现。": "All stages unlocked. Keep training for better stars.",
    "点击 Unit 卡片可直接开练，或使用右上角按钮从当前 Unit 开始。": (
        "Click a Unit card to start, or use the top-right button for the current Unit."
    ),
    "建议先完成新手教学，再开始正式训练。": "Recommended: finish the tutorial before formal training.",
    "请先完成新手教学，或在教学页选择本次跳过。": "Finish tutorial first, or choose skip for this session.",
    "该单元尚未解锁。": "This unit is not unlocked.",
    "训练进行中。": "Training in progress.",
    "Rx 识别": "Rx Identify",
    "Tx 节奏": "Tx Rhythm",
    "Rx 加速": "Rx Speed",
    "Boss Rx 连续抄收": "Boss Rx Continuous Copy",
    "Boss Tx 连续发报": "Boss Tx Continuous Keying",
    " ★": " ★",
    "{0} | 单元 {1}{2}": "{0} | Unit {1}{2}",
    "执行中：{0}": "Running: {0}",
    "开始单元 {0}/{1}": "Start Unit {0}/{1}",
    "已完成 {0}/{1}: {2}": "Completed {0}/{1}: {2}",
    "训练已停止。": "Training stopped.",
    "单元结算完成。": "Unit settlement completed.",
    "+{0} XP": "+{0} XP",
    "  · 奖励 +{0}": "  · Bonus +{0}",
    "Unit {0} 完成": "Unit {0} Completed",
    "{0:.0f}%": "{0:.0f}%",
    "准确率 {0:.1f}%": "Accuracy {0:.1f}%",
    "节奏评分 {0:.1f}": "Rhythm {0:.1f}",
    "评级 {0}": "Grade {0}",
    "连击 +1（当前总连击 {0}）": "Combo +1 (total combo {0})",
    "新内容": "New Content",
    "阶段升级成功，已解锁：{0}": "Stage upgraded. Unlocked: {0}",
    "进入下一阶段": "Enter Next Stage",
    "未达 Unit 解锁阈值：准确率≥{0:.0f}% 且节奏≥{1:.0f}。请重练本 Unit。": (
        "Unit unlock threshold not reached: accuracy ≥ {0:.0f}% and rhythm ≥ {1:.0f}. Please retry this Unit."
    ),
    "继续本 Unit": "Continue This Unit",
    "Boss 已通过 Unit 门槛，但阶段解锁需：准确率≥{0:.0f}% 、节奏≥{1:.0f} 、总分≥{2:.0f}。": (
        "Boss passed unit threshold, but stage unlock requires accuracy ≥ {0:.0f}%, rhythm ≥ {1:.0f}, score ≥ {2:.0f}."
    ),
    "可继续下一个 Unit，或再练一次本 Unit。": "You can continue to next Unit or retry this Unit.",
    # Stage definitions (dynamic content from level_defs.py)
    "Stage 1 - 节奏与基础字符": "Stage 1 - Rhythm & Core Characters",
    "Stage 2 - 字符扩展": "Stage 2 - Character Expansion",
    "Stage 3 - 单词与呼号": "Stage 3 - Words & Callsigns",
    "Stage 4 - 实战与持续抄收": "Stage 4 - Practical & Sustained Copy",
    "建立短循环听发节奏。": "Build a short-cycle listen/send rhythm.",
    "每个 Unit 只新增 1-2 个字符。": "Add only 1-2 new characters per Unit.",
    "从字符过渡到短词与呼号。": "Transition from characters to short words and callsigns.",
    "连续处理真实混合业务流。": "Continuously handle real mixed-traffic streams.",
    "建立 K/M 基础节奏。": "Build basic K/M rhythm.",
    "巩固 K/M 识别稳定性。": "Consolidate stable K/M recognition.",
    "加入 R，重点压住 K-R 混淆。": "Add R and reduce K-R confusion.",
    "加入 S，训练短码密集节奏。": "Add S and train dense short-code rhythm.",
    "Boss：无提示连续 KMRS 挑战。": "Boss: no-hint continuous KMRS challenge.",
    "加入 A，强化 A-S 区分。": "Add A and strengthen A-S distinction.",
    "加入 N，强化 N-K 区分。": "Add N and strengthen N-K distinction.",
    "Boss：Stage 1 毕业考核（无提示）。": "Boss: Stage 1 graduation test (no hints).",
    "加入 T，强化长划时值控制。": "Add T and improve long-dash timing control.",
    "加入 E，强化短码回收速度。": "Add E and improve short-code recovery speed.",
    "加入 O，强化三长划稳定性。": "Add O and stabilize triple-dash timing.",
    "加入 I，强化短码切换。": "Add I and improve short-code switching.",
    "Boss：无提示连续混合 T/E/O/I。": "Boss: no-hint continuous T/E/O/I mix.",
    "加入 H，训练高密度点串耐力。": "Add H and train high-density dit-string endurance.",
    "加入 D，训练划点切换控制。": "Add D and train dah-dit switching control.",
    "Boss：Stage 2 毕业考核（全量混合）。": "Boss: Stage 2 graduation test (full mix).",
    "从字符过渡到短词与呼号前缀。": "Transition from characters to short words and callsign prefixes.",
    "扩展呼号后缀与数字段解析。": "Expand callsign suffix and number-group parsing.",
    "引入高频缩写块。": "Introduce high-frequency abbreviation chunks.",
    "在同一循环中混合呼号与缩写。": "Mix callsigns and abbreviations in one loop.",
    "Boss：无提示连续呼号+缩写流。": "Boss: no-hint continuous callsign + abbreviation flow.",
    "引入 Q 简语语义块。": "Introduce Q-code semantic chunks.",
    "Q 简语与呼号快速上下文切换。": "Fast context switching between Q-codes and callsigns.",
    "Boss：Stage 3 混合业务毕业考核。": "Boss: Stage 3 mixed-traffic graduation test.",
    "以短报文块进入持续抄收。": "Enter sustained copy with short message blocks.",
    "增加报文块数量，保持节奏稳定。": "Increase message block count while keeping rhythm stable.",
    "加入更密集 QSO 片段，提升上下文连续性。": (
        "Add denser QSO segments to improve context continuity."
    ),
    "高密度混合业务，训练快速模式切换。": "High-density mixed traffic to train rapid mode switching.",
    "Boss：无提示长时实战流。": "Boss: no-hint long practical stream.",
    "提升长句发报稳定度。": "Improve long-sentence keying stability.",
    "在实战流中定向打击弱项混淆。": "Target weak confusion points in practical streams.",
    "Boss：Stage 4 持续抄收毕业考核。": "Boss: Stage 4 sustained-copy graduation test.",
    # Rx runner
    "听写 (Rx)": "Copy (Rx)",
    "未开始": "Not Started",
    "状态：未提交": "Status: Not Submitted",
    "本题内容": "Question",
    "题目将在这里显示": "Question will appear here",
    "播放": "Play",
    "暂停": "Pause",
    "输入答案": "Input Answer",
    "输入你听到的内容，词组请用空格分隔": "Type what you hear, separate words with spaces",
    "等待开始": "Waiting to start",
    "WPM -- | Farn --": "WPM -- | Farn --",
    "提交": "Submit",
    "下一题": "Next",
    "WPM {0}  Farn {1}  Dot {2}ms": "WPM {0}  Farn {1}  Dot {2}ms",
    "已开始收报轮次": "Rx round started",
    "已停止": "Stopped",
    "题目隐藏，请播放后输入": "Question hidden. Play first, then input.",
    "题目 {0}/{1}": "Question {0}/{1}",
    "点击“提交”查看结果，或直接“下一题”。": "Click Submit for feedback, or go Next directly.",
    "状态：已提交，可下一题": "Status: Submitted, ready for next",
    "本题判定：{0} | 准确率 {1:.1f}% | {2} | {3}": "Result: {0} | Accuracy {1:.1f}% | {2} | {3}",
    "本轮完成": "Round Completed",
    "收报均分：{0:.1f}% | 平均反应：{1:.0f}ms": "Rx avg: {0:.1f}% | Avg latency: {1:.0f}ms",
    # Tx runner
    "发报 (Tx)": "Keying (Tx)",
    "本题目标": "Target",
    "发报串": "Keyed Morse",
    "发报生成的摩尔斯串": "Morse string generated by keying",
    "译码结果": "Decoded Result",
    "提交后显示译码结果": "Decoded result shown after submit",
    "按键发报": "Keying",
    "开始按键发报。": "Start keying now.",
    "题目隐藏，请直接发报": "Question hidden. Key directly.",
    "本题判定：{0} | 准确率 {1:.1f}% | {2} | 节奏 {3:.1f} | 总分 {4:.1f} | {5}": (
        "Result: {0} | Accuracy {1:.1f}% | {2} | Rhythm {3:.1f} | Score {4:.1f} | {5}"
    ),
    "发报解码：{0:.1f}% | 节奏：{1:.1f} | 总分：{2:.1f}": "Tx decode: {0:.1f}% | Rhythm: {1:.1f} | Score: {2:.1f}",
    # Tutorial
    "新手教学：先认识点划再进入训练": "Beginner Tutorial: Learn dits/dahs before training",
    "点击下方键盘卡片学习字符；支持听音、点划输入、间隔理解（/ 为字母间隔，/// 为单词间隔）。": (
        "Click keyboard cards below to learn characters; supports playback, dot/dash input, and gap understanding "
        "(/ for letter gap, /// for word gap)."
    ),
    "完成教学并进入训练": "Finish Tutorial and Start Training",
    "稍后再学（本次跳过）": "Learn Later (Skip This Session)",
    "键盘卡片：字母 / 数字 / 常用符号": "Keyboard Cards: Letters / Numbers / Common Symbols",
    "当前学习": "Current Selection",
    "听一遍": "Play Once",
    "加入练习串": "Add to Practice",
    "间隔示例": "Gap Demo",
    "点划输入体验（听与发）": "Dot/Dash Practice (Listen & Send)",
    "输入串：": "Input:",
    "译码：": "Decoded:",
    "点 .": "Dot .",
    "划 -": "Dash -",
    "字母间隔 /": "Letter Gap /",
    "单词间隔 ///": "Word Gap ///",
    "退格": "Backspace",
    "清空": "Clear",
    "播放当前输入": "Play Current Input",
    "字符 {0} 对应点划：{1}。点击“听一遍”可听音，点击“加入练习串”可做点划输入。": (
        "Character {0} maps to {1}. Click 'Play Once' to listen, or 'Add to Practice' for input practice."
    ),
    "输入串：{0}": "Input: {0}",
    "（暂无可译码内容）": "(No decodable content yet)",
    "译码：{0}": "Decoded: {0}",
    "间隔示例已播放：字符间隔用 / ，单词间隔用 ///。": "Gap demo played: / for letter gap, /// for word gap.",
    # TX settings
    "WPM 速率:": "WPM Rate:",
    "当前发报速度: {0} WPM": "Current Sending Speed: {0} WPM",
    "点长度: {0} 毫秒": "Dot Length: {0} ms",
    "划长度: {0} 毫秒": "Dash Length: {0} ms",
    "字母间隔: {0} 毫秒": "Letter Gap: {0} ms",
    "单词间隔: {0} 毫秒": "Word Gap: {0} ms",
    # QSO dialog / record
    "QSO 记录": "QSO Records",
    "关键词": "Keyword",
    "关键词（呼号/译文/原码）": "Keyword (Callsign/Translation/Morse)",
    "全部方向": "All Directions",
    "发送": "Send",
    "接收": "Receive",
    "启用时间范围": "Enable Date Range",
    "重置": "Reset",
    "刷新": "Refresh",
    "方向": "Direction",
    "结束日期": "End Date",
    "每页条数": "Page Size",
    "时间": "Time",
    "时长": "Duration",
    "呼号": "Callsign",
    "译文预览": "Translation Preview",
    "原码长度": "Morse Length",
    "删除选中": "Delete Selected",
    "撤销删除": "Undo Delete",
    "导出 CSV": "Export CSV",
    "上一页": "Prev",
    "下一页": "Next",
    "译文全文": "Full Translation",
    "原始电码全文": "Full Raw Morse",
    "复制译文": "Copy Translation",
    "复制原码": "Copy Morse",
    "查看时序": "View Timeline",
    "第 {0}/{1} 页，共 {2} 条": "Page {0}/{1}, Total {2}",
    "有 {0} 条损坏记录已忽略。": "{0} broken records were ignored.",
    "请选择一条记录查看详情": "Select one record to view details",
    "该记录无时序数据": "No timing data for this record",
    "可查看时序回放": "Timing playback is available",
    "请先选择要删除的记录": "Please select records to delete first",
    "确认删除": "Confirm Deletion",
    "确认删除选中的 {0} 条记录吗？": "Delete selected {0} records?",
    "删除失败": "Delete Failed",
    "未找到可删除的记录": "No deletable records found",
    "恢复失败": "Restore Failed",
    "未恢复任何记录": "No records were restored",
    "当前没有可导出的记录": "No records to export",
    "导出失败": "Export Failed",
    "写入文件失败：{0}": "Failed to write file: {0}",
    "已导出选中的 {0} 条记录。": "Exported {0} selected records.",
    "已导出当前筛选结果，共 {0} 条记录。": "Exported current filtered results, total {0} records.",
    "导出完成": "Export Completed",
    "时序可视化": "Timing Visualization",
    "该记录无可用时序数据": "No available timing data for this record",
    # Key modifier dialog
    "连接器设置": "Connector Settings",
    "选择串口:": "Select Serial Port:",
    "刷新串口列表": "Refresh Port List",
    "读取按键": "Read Keys",
    "按键1:": "Key 1:",
    "按键1": "Key 1",
    "按键2:": "Key 2:",
    "按键2": "Key 2",
    "键盘": "Keyboard",
    "鼠标": "Mouse",
    "功能键": "Function Key",
    "写入按键": "Write Keys",
    "状态：就绪": "Status: Ready",
    "状态：处理中...": "Status: Processing...",
    "状态：失败": "Status: Failed",
    "状态：已停止": "Status: Stopped",
    "按键已写入。": "Keys written.",
    "读取按键成功。": "Read keys successfully.",
    "串口操作进行中，请稍候再关闭。": "Serial operation in progress, please close later.",
    "左键": "Left Button",
    "右键": "Right Button",
    "中键": "Middle Button",
    "报文格式错误：返回字段不足": "Packet format error: insufficient fields returned",
    "端口未选择，请先选择串口。": "No port selected. Please select a serial port first.",
    "设备无响应，请检查端口是否正确、线缆是否连接。": "Device not responding. Check port and cable connection.",
    "读取成功": "Read successful",
    "写入数据为空。": "Write payload is empty.",
    "写入成功": "Write successful",
    "未知串口操作。": "Unknown serial operation.",
    "串口错误：{0}": "Serial error: {0}",
    "操作失败：{0}": "Operation failed: {0}",
    "键盘模式仅支持单个字符，请输入 1 个字符。": (
        "Keyboard mode supports only one character. Please input exactly 1."
    ),
    "{0} 未设置。": "{0} is not set.",
    "注意：\n1. 先选择正确串口，再执行读取或写入。\n2. 操作中按钮会锁定，请等待完成。\n3. 若端口错误或设备无响应，请更换端口重试。": (
        "Note:\n1. Select the correct serial port before read/write.\n"
        "2. Buttons are locked during operation, please wait.\n"
        "3. If port is wrong or no response, switch port and retry."
    ),
    # About / update dialogs
    "关于 MorseLink": "About MorseLink",
    "业余无线电通联训练与在线通联工具": "Amateur radio training and online QSO tool",
    "项目链接": "Project Links",
    "GitHub 仓库": "GitHub Repository",
    "Wiki 使用说明": "Wiki Guide",
    "当前版本": "Current Version",
    "复制版本号": "Copy Version",
    "检查更新": "Check Updates",
    "关闭": "Close",
    "已复制版本号": "Version copied",
    "未知": "Unknown",
    "（未提供更新日志）": "(No release notes provided)",
    "\n\n...（更新日志过长，已截断）": "\n\n...(Release notes too long, truncated)",
    "发现新版本": "New Version Found",
    "发现新版本：v{0}\n发布时间：{1}\n\n更新日志：\n{2}": (
        "New version found: v{0}\nPublished: {1}\n\nRelease notes:\n{2}"
    ),
    "下载更新": "Download Update",
    "查看详情": "View Details",
    "不更新": "Skip Update",
    # Legacy learn pages
    "字母和符号": "Letters & Symbols",
    "Q简语": "Q Abbrev",
    "缩略语": "Abbreviations",
    "句子": "Sentences",
    "当前课程：未选择": "Current Lesson: Not Selected",
    "请输入你听到的内容": "Enter what you heard",
    "正确答案将显示在这里": "Correct answer will appear here",
    "正确率 0%": "Accuracy 0%",
    "检查结果": "Check Result",
    "结果摘要将显示在这里": "Result summary will appear here",
    "请先播放随机音频": "Please play random audio first",
    "请先选择课程": "Please select a lesson first",
    "请先选择课程。": "Please select a lesson first.",
    "课程 {0}: {1}": "Lesson {0}: {1}",
    "无标题": "Untitled",
    "无内容": "No Content",
    "无类型": "No Type",
    "无备注": "No Note",
    "当前课程:": "Current Lesson:",
    "查看结果": "View Result",
    "随机出题": "Random Question",
    "请先随机出题": "Please generate a random question first",
    "题目：": "Question: ",
    "题目将显示在这里": "Question will appear here",
    "发报内容将显示在这里": "Keyed content will appear here",
    # Training detailed feedback
    "正确": "Correct",
    "有误": "Incorrect",
    "偏置反馈：漏码偏多，建议放慢一点并拉开字符间隔。": (
        "Bias: more misses; slow down slightly and widen character spacing."
    ),
    "偏置反馈：漏码偏多，建议拉开字符间隔。": "Bias: more misses; widen character spacing.",
    "偏置反馈：多码偏多，建议按键更干净，减少粘连。": (
        "Bias: more extras; key cleaner to reduce stickiness."
    ),
    "偏置反馈：多码偏多，建议减少粘连与误触。": (
        "Bias: more extras; reduce stickiness and false taps."
    ),
    "偏置反馈：错码偏多，建议先稳节奏再提速。": (
        "Bias: more substitutions; stabilize rhythm before speeding up."
    ),
    "偏置反馈：整体平衡，继续保持。": "Bias: well-balanced overall, keep it up.",
    "错误点：无": "Error points: None",
    "错误点：": "Error points: ",
    "第{0}位 {1}->{2}": "Pos {0} {1}->{2}",
    "第{0}位漏抄({1})": "Pos {0} missed copy ({1})",
    "第{0}位多抄({1})": "Pos {0} extra copy ({1})",
    "第{0}位漏发({1})": "Pos {0} missed send ({1})",
    "第{0}位多发({1})": "Pos {0} extra send ({1})",
    " 等{0}处": " and {0} more",
    # Utility feedback / profiles
    "错:{0}": "Err:{0}",
    "漏:{0}": "Miss:{0}",
    "多:{0}": "Extra:{0}",
    "漏:∅": "Miss:∅",
    "正确 {0}/{1}": "Correct {0}/{1}",
    "错码 {0}": "Substitutions {0}",
    "漏码 {0}": "Misses {0}",
    "多码 {0}": "Extras {0}",
    "准确率 {0}%": "Accuracy {0}%",
    "首错位置 {0}": "First error at {0}",
    "建议: {0}": "Suggestion: {0}",
    "节奏稳定，继续保持。": "Rhythm is stable. Keep it up.",
    "漏码偏多，建议稍微放慢并关注字符间隔。": (
        "Too many misses. Slow down slightly and mind character spacing."
    ),
    "多码偏多，建议抬键更干净、间隔更明确。": (
        "Too many extras. Release key cleaner and make gaps clearer."
    ),
    "错码偏多，建议强化点划时值辨识。": "Too many substitutions. Strengthen dit/dah timing recognition.",
    "所有长度和组数参数必须是整数": "All length and group parameters must be integers",
    "等级": "Level",
    "词长": "Word Length",
    "组数": "Groups",
    "核心权重": "Core Weight",
    # Multi-table tool
    "输入关键字过滤…": "Type keywords to filter...",
    "摩尔斯电码参考表": "Morse Code Reference",
    "常用短语对照表": "Common Phrase Reference",
    "摩尔斯码": "Morse",
    "字符": "Character",
    "英文": "English",
    "中文": "Chinese",
    "缩写": "Abbreviation",
    "键": "Key",
    "值": "Value",
    "显示 {0}/{1}": "Showing {0}/{1}",
    # Training trend widgets
    "暂无训练数据": "No training data yet",
    "节奏分": "Rhythm Score",
    "准确率": "Accuracy",
    "WPM": "WPM",
    # HTML panel labels in online page
    "<h3>收到电码:</h3>": "<h3>Received Morse:</h3>",
    "<h3>收到电码翻译:</h3>": "<h3>Received Translation:</h3>",
    "<h3>发送电码翻译:</h3>": "<h3>Sent Translation:</h3>",
    "<h3>发送电码:</h3>": "<h3>Sent Morse:</h3>",
    "<h3>发送电码：发射禁用，请稍后再试</h3>": "<h3>Sent Morse: TX disabled, please try later</h3>",
    "<h3>当前频道人数:</h3>": "<h3>Current Channel Participants:</h3>",
}


def build_translator(language: str | None) -> QTranslator | None:
    if normalize_language(language) != "en":
        return None
    return DictTranslator(EN_TRANSLATIONS)
